# CouplePlan 開発計画

## 現在の状況

### ✅ 完了済み

#### 1. **基盤セットアップ** - 完了

- ✅ Supabaseプロジェクト作成
- ✅ Next.js 15 + TypeScript + Tailwind CSS
- ✅ データベーススキーマ設計
- ✅ 開発環境構築

#### 2. **認証システム** - 完全安定化完了

- ✅ ログイン/サインアップ機能
- ✅ メール認証
- ✅ パスワードリセット
- ✅ セッション管理（localStorage + メモリ管理）
- ✅ プライベートブラウジング対応
- ✅ 認証フロー最適化
- ✅ エラーハンドリング強化

#### 3. **プロフィール機能** - 完了

- ✅ プロフィール編集機能（名前、メール、居住地、誕生日、記念日）
- ✅ プロフィールデータの永続化（Supabase）
- ✅ バリデーション機能（名前、メールアドレス、日付）
- ✅ アカウント削除機能
- ✅ パスワード変更機能
- ✅ プライバシー設定画面

#### 4. **パートナー連携機能** - 完了

- ✅ 招待コード生成（6桁、24時間有効）
- ✅ 招待コード検証
- ✅ カップル関係の確立
- ✅ パートナー情報の表示
- ✅ ダッシュボードからのナビゲーション
- ✅ エラーハンドリング

#### 5. **データベース設定** - 完了

- ✅ `profiles`テーブルとRLSポリシー
- ✅ `couple_invitations`テーブルとRLSポリシー
- ✅ `couples`テーブルとRLSポリシー
- ✅ データベーススキーマの永続化

#### 6. **UI/UXの実装** - 完了

- ✅ モダンなデザイン
- ✅ レスポンシブ対応
- ✅ フォームバリデーション
- ✅ エラーハンドリング
- ✅ ローディング状態の表示

### 📊 開発進捗サマリー

| カテゴリ         | 進捗率 | 状態      |
| ---------------- | ------ | --------- |
| 認証システム     | 100%   | ✅ 完了   |
| プロフィール機能 | 100%   | ✅ 完了   |
| パートナー連携   | 100%   | ✅ 完了   |
| データベース設定 | 100%   | ✅ 完了   |
| AIデートプラン   | 90%    | 🚧 進行中 |
| 共同編集機能     | 0%     | 📝 未着手 |
| Date Canvas      | 0%     | 📝 未着手 |

### 🔧 現在の課題

**なし** - 基本機能は完成しました。次の機能開発フェーズに進みます。

### 🎉 本セッションで完了したタスク

1. ✅ アバター画像アップロード機能の削除（不要な機能を削減）
2. ✅ プロフィール編集機能の完成
3. ✅ メールアドレス編集機能の追加
4. ✅ パートナー連携機能の完全実装
5. ✅ 招待コード生成・検証・カップル関係確立
6. ✅ データベースRLSポリシーの設定
7. ✅ アカウント削除機能の改善
8. ✅ バリデーション機能の強化
9. ✅ ダッシュボードナビゲーションの追加
10. ✅ 認証トークンベースのAPI実装

## 次の開発ステップ

### 🎯 優先度：高

#### 1. AIデートプラン提案機能（UC-001） - 90%完了 🚧

- [x] デートプラン作成画面の実装
- [x] AI生成中画面の実装（モック実装）
- [x] プラン提案画面の実装
- [x] プラン詳細画面の実装
- [x] カスタマイズビュー画面の実装 ✨ NEW
- [x] プラン保存・読み込み機能
- [x] カップル専用プラン機能
- [x] プランアイテム追加・編集・削除機能 ✨ NEW
- [x] 予算・時間の自動計算 ✨ NEW
- [x] プラン確定機能（ステータス管理） ✨ NEW
- [ ] AI API連携（OpenAI または Anthropic Claude） - モックのみ実装済み

#### 2. ダッシュボード機能の改善

- [ ] カップル情報の表示（連携状態、記念日カウント）
- [ ] 最近のアクティビティ表示
- [ ] クイックアクション機能
- [ ] 統計情報の充実化

### 🎯 優先度：中

#### 3. 共同編集機能（UC-002）

- [ ] 共同編集画面の実装
- [ ] リアルタイム同期機能
- [ ] 編集競合解決機能
- [ ] 編集履歴画面
- [ ] プレビュー画面

#### 4. Date Canvas機能（UC-005）

- [ ] 思い出記録機能
- [ ] 位置情報ピン機能
- [ ] 画像アップロード機能
- [ ] タグ・カテゴリ管理
- [ ] 検索・フィルター機能

#### 5. AI喧嘩仲裁・関係修復機能（UC-004）

- [ ] 仲裁依頼画面
- [ ] 状況分析機能
- [ ] AI仲裁提案
- [ ] 関係改善プラン
- [ ] 振り返りレポート

### 🎯 優先度：低

#### 6. ポータル機能（UC-003）

- [ ] ポータルトップ画面
- [ ] デート情報検索画面
- [ ] 記事詳細画面
- [ ] アプリ誘導機能
- [ ] 利用ガイド

#### 7. マネタイズ機能（UC-007）

- [ ] 課金管理画面
- [ ] 機能解放画面
- [ ] サブスクリプション管理
- [ ] 課金指標分析

## 技術的改善項目

### 🔧 短期的な改善（1-2週間）

1. **AI機能の統合**
   - OpenAI APIまたはAnthropic Claude APIの統合
   - プロンプトエンジニアリング
   - レート制限対策
   - エラーハンドリング

2. **データベーススキーマの拡張**
   - `date_plans`テーブルのRLSポリシー
   - `memories`テーブルのRLSポリシー
   - リアルタイム機能の設定

3. **テスト環境の構築**
   - 単体テストの追加
   - E2Eテストの実装
   - CI/CDパイプラインの構築

### 🔧 中期的な改善（1-2ヶ月）

1. **パフォーマンス最適化**
   - クエリ最適化
   - バンドルサイズの削減
   - キャッシュ戦略の実装
   - 画像最適化

2. **アクセシビリティの向上**
   - キーボードナビゲーション
   - スクリーンリーダー対応
   - カラーコントラストの改善
   - WCAG 2.1 AA準拠

3. **セキュリティ強化**
   - CSP（Content Security Policy）の実装
   - CORS設定の最適化
   - レート制限の実装
   - 監査ログの実装

## 推奨する次のアクション

### 🚀 今すぐ実行すべきこと

1. **AIデートプラン提案機能の実装**
   - AI API連携の準備（APIキー取得）
   - デートプラン作成画面の実装
   - AI生成機能の基盤構築

2. **ダッシュボード機能の改善**
   - カップル情報の表示
   - 記念日カウントダウン
   - 統計情報の表示

3. **データベーススキーマの拡張**
   - `date_plans`テーブルのRLSポリシー設定
   - その他必要なテーブルのRLS設定

### 📋 今週中に完了すべきこと

1. ✅ プロフィール機能の完成（完了）
2. ✅ パートナー連携機能の完成（完了）
3. デートプラン機能の基本実装

### 🎯 来週の目標

1. AI機能の統合
2. 共同編集機能の実装開始
3. テスト環境の構築

## 技術スタック

### 現在使用中

- **フロントエンド**: Next.js 15, React 19, TypeScript, Tailwind CSS
- **バックエンド**: Supabase, Next.js API Routes
- **認証**: Supabase Auth（PKCE認証フロー）
- **データベース**: Supabase PostgreSQL
- **状態管理**: React Hooks（useState, useEffect, useContext）
- **バリデーション**: カスタムバリデーション関数
- **デプロイ**: Vercel（予定）

### 追加検討中

- **AI機能**: OpenAI API または Anthropic Claude API
- **リアルタイム**: Supabase Realtime
- **テスト**: Jest, Playwright
- **モニタリング**: Sentry（エラー追跡）
- **分析**: Google Analytics または Mixpanel

## 実装済みの機能

### ✅ 完成した画面

1. **認証関連**
   - ログイン画面（`/login`）
   - サインアップ画面（`/signup`）
   - パスワードリセット画面（`/reset-password`）

2. **ダッシュボード**
   - メインダッシュボード（`/dashboard`）
   - プロフィール画面（`/dashboard/profile`）
   - パートナー連携画面（`/dashboard/partner-linkage`）
   - プライバシー設定画面（`/dashboard/privacy`）

3. **API Routes**
   - 認証API（`/api/auth/login`, `/api/auth/signup`）
   - パートナー連携API（`/api/partner/*`）
   - アカウント管理API（`/api/account`）

### 🔧 実装中の機能

**なし** - 次の機能開発待ち

## 注意事項

### セキュリティ

- ✅ Row Level Security（RLS）を全テーブルで有効化
- ✅ 認証トークンベースのAPI認証
- ✅ XSS対策
- ✅ TypeScript型安全性
- ⚠️ CSP（Content Security Policy）未実装
- ⚠️ レート制限未実装

### パフォーマンス

- ✅ Next.js 15の最適化機能を活用
- ✅ サーバーサイドレンダリング
- ⚠️ 画像最適化未実装
- ⚠️ キャッシュ戦略未実装

### アクセシビリティ

- ✅ セマンティックHTML
- ✅ キーボード操作対応（一部）
- ⚠️ スクリーンリーダー完全対応未実装
- ⚠️ WCAG 2.1 AA準拠未確認

### スケーラビリティ

- ✅ マイクロサービスアーキテクチャ設計
- ✅ Supabaseによるスケーラブルなインフラ
- ⚠️ 大規模トラフィック対策未実装

## 開発の進め方

### 推奨アプローチ

1. **MVPファースト**: 最小限の機能で早期リリース
2. **ユーザーフィードバック**: 実際のユーザーからフィードバックを得る
3. **段階的改善**: 優先度に基づいて機能を追加
4. **品質重視**: セキュリティとパフォーマンスを妥協しない

### 開発サイクル

1. **計画** → 2. **実装** → 3. **テスト** → 4. **デプロイ** → 5. **フィードバック** → 1に戻る

## クイックスタートガイド

### 🚀 新規開発者向けセットアップ

1. **リポジトリのクローン**

   ```bash
   git clone <repository-url>
   cd coupleplan
   npm install
   ```

2. **環境変数の設定**
   - `.env.local`ファイルを作成
   - Supabaseの認証情報を設定（`NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY`, `SUPABASE_SERVICE_ROLE_KEY`）

3. **Supabaseデータベースの設定**
   - `Docs/DATABASE_MIGRATION_GUIDE.md`を参照
   - 必要なテーブルとRLSポリシーを作成

4. **開発サーバーの起動**

   ```bash
   npm run dev
   ```

5. **動作確認**
   - `http://localhost:3000`にアクセス
   - アカウント作成、ログイン、プロフィール編集をテスト

### 📚 主要ドキュメント

- **データベースセットアップ**: `Docs/SUPABASE_SETUP.md`
- **認証システム設計**: `Docs/認証システム設計書.md`
- **データモデル**: `Docs/データモデル図.md`
- **画面一覧**: `Docs/画面一覧・遷移図.md`

---

**最終更新**: 2025年10月8日  
**バージョン**: v0.2.0  
**次回レビュー**: AIデートプラン提案機能実装後  
**担当者**: 開発チーム
