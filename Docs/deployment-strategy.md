# CouplePlan ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥

## æ¦‚è¦

CouplePlanãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ã‚·ãƒ³ãƒ—ãƒ«ã§åŠ¹ç‡çš„ãªCI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚GitHub Actionsã¨Google Cloud Runã‚’ä½¿ç”¨ã—ãŸè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚Šã€å“è³ªã‚’ä¿ã¡ãªãŒã‚‰è¿…é€Ÿãªãƒªãƒªãƒ¼ã‚¹ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚

## ãƒ–ãƒ©ãƒ³ãƒæˆ¦ç•¥

```mermaid
graph LR
    A[feature/*] --> B[develop]
    B --> C[main]
    C --> D[Production Deploy]
```

### ãƒ–ãƒ©ãƒ³ãƒã®å½¹å‰²

- **feature/\***: æ©Ÿèƒ½é–‹ç™ºãƒ–ãƒ©ãƒ³ãƒ
- **develop**: é–‹ç™ºçµ±åˆãƒ–ãƒ©ãƒ³ãƒï¼ˆCIå®Ÿè¡Œï¼‰
- **main**: æœ¬ç•ªãƒªãƒªãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒï¼ˆCDå®Ÿè¡Œï¼‰

## CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

### ğŸ”„ CIï¼ˆç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰

**ãƒˆãƒªã‚¬ãƒ¼**: `develop`ãƒ–ãƒ©ãƒ³ãƒã¸ã®push/PR

#### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ§‹æˆ

1. **Lint**

   - ESLint/Prettierã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯
   - ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã®éµå®ˆç¢ºèª

2. **Unit Tests**

   - ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
   - ãƒ†ã‚¹ãƒˆçµæœã®HTML/XMLãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
   - ãƒ†ã‚¹ãƒˆçµæœã®è‡ªå‹•ã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿

3. **Integration Tests**
   - çµ±åˆãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
   - ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ

#### å®Ÿè¡Œç’°å¢ƒ

- **OS**: Ubuntu Latest
- **Node.js**: v20
- **ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³**: Asia/Tokyo
- **ä¸¦åˆ—å®Ÿè¡Œ**: lintå®Œäº†å¾Œã€unit-testsã¨integration-testsãŒä¸¦åˆ—å®Ÿè¡Œ

### ğŸš€ CDï¼ˆç¶™ç¶šçš„ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆï¼‰

**ãƒˆãƒªã‚¬ãƒ¼**: `main`ãƒ–ãƒ©ãƒ³ãƒã¸ã®push

#### ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼

1. **èªè¨¼**

   - Google Cloud Workload Identity Federation
   - ã‚»ã‚­ãƒ¥ã‚¢ãªèªè¨¼æƒ…å ±ç®¡ç†

2. **ã‚³ãƒ³ãƒ†ãƒŠãƒ“ãƒ«ãƒ‰**

   - Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰
   - Google Container Registryã¸ã®push
   - ç’°å¢ƒå¤‰æ•°ã®æ³¨å…¥

3. **ãƒ‡ãƒ—ãƒ­ã‚¤**
   - Google Cloud Runã¸ã®ç›´æ¥ãƒ‡ãƒ—ãƒ­ã‚¤
   - ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ãªã—ã®è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆ

## ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆ

### Google Cloud Platform

- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: `serious-bearing-460203-r6`
- **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**: `asia-northeast1`
- **ã‚µãƒ¼ãƒ“ã‚¹**: Cloud Run
- **ãƒ¬ã‚¸ã‚¹ãƒˆãƒª**: Artifact Registry

### ç’°å¢ƒå¤‰æ•°

#### ãƒ“ãƒ«ãƒ‰æ™‚å¤‰æ•°

```bash
NEXT_PUBLIC_SUPABASE_URL
NEXT_PUBLIC_SUPABASE_ANON_KEY
SUPABASE_SERVICE_ROLE_KEY
DATABASE_URL
RESEND_API_KEY
ADMIN_EMAIL
FROM_EMAIL
```

#### å®Ÿè¡Œæ™‚å¤‰æ•°

åŒã˜ç’°å¢ƒå¤‰æ•°ãŒCloud Runã‚µãƒ¼ãƒ“ã‚¹ã«è¨­å®šã•ã‚Œã¾ã™

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### èªè¨¼æ–¹å¼

- **Workload Identity Federation**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ¬ã‚¹èªè¨¼
- **GitHub Secrets**: æ©Ÿå¯†æƒ…å ±ã®å®‰å…¨ãªç®¡ç†
- **ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ**: æœ€å°æ¨©é™ã®åŸå‰‡

### ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

- Cloud Runã‚µãƒ¼ãƒ“ã‚¹ã¯èªè¨¼ä¸è¦ã§å…¬é–‹
- å†…éƒ¨APIã¯èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½

## ç›£è¦–ãƒ»ãƒ­ã‚°

### GitHub Actions

- **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ­ã‚°**: å„ã‚¹ãƒ†ãƒƒãƒ—ã®è©³ç´°ãƒ­ã‚°
- **ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ**: è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹HTML/XMLãƒ¬ãƒãƒ¼ãƒˆ
- **ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆ**: ãƒ†ã‚¹ãƒˆçµæœã®ä¿æŒï¼ˆ7-14æ—¥ï¼‰

### Google Cloud

- **Cloud Run ãƒ­ã‚°**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°
- **Cloud Monitoring**: ãƒ¡ãƒˆãƒªã‚¯ã‚¹ç›£è¦–
- **Error Reporting**: ã‚¨ãƒ©ãƒ¼è¿½è·¡

## ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

### é€šå¸¸ãƒªãƒªãƒ¼ã‚¹

1. **æ©Ÿèƒ½é–‹ç™º**

   ```bash
   git checkout -b feature/new-feature
   # é–‹ç™ºä½œæ¥­
   git push origin feature/new-feature
   ```

2. **é–‹ç™ºç’°å¢ƒçµ±åˆ**

   ```bash
   git checkout develop
   git merge feature/new-feature
   git push origin develop
   # â†’ CIå®Ÿè¡Œ
   ```

3. **æœ¬ç•ªãƒªãƒªãƒ¼ã‚¹**
   ```bash
   git checkout main
   git merge develop
   git push origin main
   # â†’ CDå®Ÿè¡Œï¼ˆè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰
   ```

### ç·Šæ€¥ä¿®æ­£

ç¾åœ¨ã®æ§‹æˆã§ã¯ç·Šæ€¥ä¿®æ­£ç”¨ã®ç‰¹åˆ¥ãªãƒ•ãƒ­ãƒ¼ã¯è¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚é€šå¸¸ã®ãƒ•ãƒ­ãƒ¼ã‚’ä½¿ç”¨ã—ã¦è¿…é€Ÿã«å¯¾å¿œã—ã¾ã™ã€‚

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

#### CIå¤±æ•—æ™‚

1. **Lintã‚¨ãƒ©ãƒ¼**: ã‚³ãƒ¼ãƒ‰å“è³ªã®ä¿®æ­£
2. **ãƒ†ã‚¹ãƒˆå¤±æ•—**: ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã¾ãŸã¯å®Ÿè£…ã®ä¿®æ­£
3. **ä¾å­˜é–¢ä¿‚**: `npm install`ã®å®Ÿè¡Œ

#### CDå¤±æ•—æ™‚

1. **èªè¨¼ã‚¨ãƒ©ãƒ¼**: Secretsè¨­å®šã®ç¢ºèª
2. **ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼**: ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª
3. **ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¨ãƒ©ãƒ¼**: Cloud Runã‚µãƒ¼ãƒ“ã‚¹ã®çŠ¶æ…‹ç¢ºèª

### å¾©æ—§æ‰‹é †

#### Cloud Runã‹ã‚‰ã®æ‰‹å‹•å¾©æ—§

```bash
# å‰ã®ãƒªãƒ“ã‚¸ãƒ§ãƒ³ã¸ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
gcloud run services update-traffic coupleplan \
  --region=asia-northeast1 \
  --to-revisions=PREVIOUS_REVISION=100
```

## æ”¹å–„ã®æ©Ÿä¼š

ç¾åœ¨ã®ã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹æˆã¯å®‰å®šã—ã¦ã„ã¾ã™ãŒã€ä»¥ä¸‹ã®æ”¹å–„ã‚’æ¤œè¨ã§ãã¾ã™ï¼š

### çŸ­æœŸçš„æ”¹å–„

- **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**: ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®è‡ªå‹•ç¢ºèª
- **é€šçŸ¥æ©Ÿèƒ½**: Slack/ãƒ¡ãƒ¼ãƒ«é€šçŸ¥
- **ç’°å¢ƒåˆ†é›¢**: ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒã®è¿½åŠ 

### é•·æœŸçš„æ”¹å–„

- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³**: ä¾å­˜é–¢ä¿‚è„†å¼±æ€§ãƒã‚§ãƒƒã‚¯
- **E2Eãƒ†ã‚¹ãƒˆ**: ãƒ–ãƒ©ã‚¦ã‚¶è‡ªå‹•åŒ–ãƒ†ã‚¹ãƒˆ
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–**: Lighthouse CI

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™

### ç¾åœ¨ã®æŒ‡æ¨™

- **CIå®Ÿè¡Œæ™‚é–“**: ç´„5-10åˆ†
- **CDå®Ÿè¡Œæ™‚é–“**: ç´„3-5åˆ†
- **ãƒ‡ãƒ—ãƒ­ã‚¤é »åº¦**: æ‰‹å‹•ï¼ˆmain pushãƒ™ãƒ¼ã‚¹ï¼‰
- **å¾©æ—§æ™‚é–“**: æ‰‹å‹•å¯¾å¿œ

### ç›®æ¨™æŒ‡æ¨™

- **CIå®Ÿè¡Œæ™‚é–“**: 5åˆ†ä»¥å†…
- **CDå®Ÿè¡Œæ™‚é–“**: 3åˆ†ä»¥å†…
- **ãƒ‡ãƒ—ãƒ­ã‚¤é »åº¦**: é€±1-2å›
- **å¾©æ—§æ™‚é–“**: 15åˆ†ä»¥å†…

## é€£çµ¡å…ˆãƒ»ã‚µãƒãƒ¼ãƒˆ

### GitHub Actions

- **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**: `.github/workflows/`
- **ãƒ­ã‚°**: GitHub Actionsã‚¿ãƒ–
- **è¨­å®š**: ãƒªãƒã‚¸ãƒˆãƒªSettings > Secrets

### Google Cloud

- **ã‚³ãƒ³ã‚½ãƒ¼ãƒ«**: [Google Cloud Console](https://console.cloud.google.com/)
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: `serious-bearing-460203-r6`
- **ã‚µãƒãƒ¼ãƒˆ**: [Cloud Run ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://cloud.google.com/run/docs)

---

_æœ€çµ‚æ›´æ–°: 2024å¹´12æœˆ_
